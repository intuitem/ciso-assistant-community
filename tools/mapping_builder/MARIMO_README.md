# Heatmap Builder - Marimo Notebook

This is an interactive notebook version of the heatmap builder using [Marimo](https://marimo.io), a reactive Python notebook.

## Installation

First, install Marimo:

```bash
pip install marimo
# or
uv pip install marimo
```

Make sure you also have the required dependencies:

```bash
pip install pandas numpy matplotlib seaborn
```

## Running the Notebook

Start the Marimo notebook server:

```bash
marimo edit tools/mapping_builder/heatmap_builder_notebook.py
```

This will open the interactive notebook in your web browser.

## Features

The interactive notebook provides:

- **File Upload**: Drag and drop your mapping CSV file
- **Interactive Controls**:
  - Score threshold slider (filter low-confidence mappings)
  - Toggle between ref_ids and indices for labels
  - Colormap selection (YlOrRd, viridis, plasma, etc.)
  - Adjustable figure size
- **Real-time Updates**: The heatmap updates automatically as you change parameters
- **Statistics Dashboard**: View mapping statistics and matrix metrics
- **Data Preview**: See your mapping data in a table

## Usage

1. **Upload a mapping CSV** file (generated by `sbert_mapper.py` or similar tools)
2. **Adjust parameters** using the interactive controls
3. **View the heatmap** and statistics in real-time
4. **Save the image** by right-clicking on the heatmap

## Required CSV Format

The CSV file must contain these columns:
- `source_ref_id`: Source framework item reference ID
- `target_ref_id`: Target framework item reference ID
- `score`: Relationship score (0.0 to 1.0)

## Why Marimo?

Marimo offers several advantages over Jupyter:

- **Reactive**: Cells automatically re-run when dependencies change
- **Reproducible**: No hidden state - always runs in order
- **Python files**: Notebooks are stored as `.py` files, git-friendly
- **Interactive UI**: Built-in UI elements (sliders, dropdowns, file uploads)
- **Fast**: Efficient execution and rendering

## Command-Line Alternative

For batch processing or automation, use the original script:

```bash
python heatmap_builder.py --input mapping.csv --output heatmap.png --threshold 0.5
```

## Examples

### Example 1: Quick exploration
1. Upload your CSV file
2. Use threshold slider to filter mappings
3. Try different colormaps to find the best visualization

### Example 2: Publication-ready figures
1. Upload CSV
2. Set threshold to show only high-confidence mappings (e.g., 0.7)
3. Enable ref_id labels if dataset is small
4. Adjust figure size for your publication format
5. Save the image

## Troubleshooting

**"Missing required columns" error**
- Ensure your CSV has `source_ref_id`, `target_ref_id`, and `score` columns

**Labels are too crowded**
- Uncheck "Use ref_ids as labels" to use indices instead
- Increase figure size using the sliders

**Heatmap is too slow to render**
- Use threshold slider to filter the dataset
- Reduce figure size

## Learn More

- [Marimo Documentation](https://docs.marimo.io)
- [Marimo GitHub](https://github.com/marimo-team/marimo)
